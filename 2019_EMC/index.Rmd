---
title: "cvGEE:<br/>Cross-Validated Scoring Rules for GEE"
author: "Dimitris Rizopoulos"
date: "????"
output:
  ioslides_presentation:
    css: pres.css
    widescreen: yes
    mathjax: default
    logo: emc.png
transition: none
runtime: shiny
---

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({ TeX: { extensions: ["color.js"] }});
</script>

```{r setup, echo = FALSE, message = FALSE, warning = FALSE}
library("cvGEE")
library("geepack")
library("splines")
library("lattice")
library("MESS")
data("toenail", package = "HSAUR2")
```

# Motivation

## Mixed models

<br/>

- Mixed effects models have numerous applications
    + Longitudinal data
    + Clustered data
    + Multilevel data
    + ...

## The basic idea

<br/>

- We have a grouped outcome ${\color{blue} Y}$
    + measurements in the same group(s) are correlated

<br/>

- Correlations are modeled via random effects ${\color{red} b}$
    + measurements in the same group share the same random effect

## Mathematical definition - 1

- A general definition of mixed models:
$$
\left \{
\begin{array}{ccl}
{\color{blue} Y} \mid {\color{red} b} & \sim & \mathcal F(\theta_y)\\&&\\
{\color{red} b} & \sim & \mathcal N(0, D)\\
\end{array}
\right.
$$
<br/>
    + the distribution $\mathcal F$ depends on the outcome
    + the random effects most often are assumed normally distributed
    + $\theta = (\theta_y^\top, \mbox{vech}(D)^\top)^\top$ are the model parameters

## Mathematical definition - 2

- To estimate mixed models under maximum likelihood we need
the marginal log-likelihood function
$$
\ell(\theta) = \sum_{i = 1}^n \log \int p(y_i \mid b_i; \theta) \, p(b_i; \theta) \; db_i
$$ 
<div style = "padding:120px">
<font color = "red">To estimate mixed models we need to solve the integral</font>
</div>

## Normal vs the rest - 1

- The random effects $b$ are assumed to have a (multivariate) normal distribution
<br/><br/>
- When 
    + the outcome $Y$ also has a normal distribution,
    + the random effects enter linearly in the linear predictor

<div style = "padding:33px">
<font color = "black">the integral can be solved</font> <font color = "purple">*analytically*</font>
<br/><br/>
${\color{blue} \Rightarrow}$ <font color = "blue">Easy to program</font> 
${\color{blue} \Rightarrow}$ <font color = "blue">Stable algorithms available in most software</font>
</div>

## Normal vs the rest - 2

<br/>

- However, in all other cases these integrals cannot be solved analytically

<br/>

<div style = "padding:50px">
${\color{red} \Rightarrow}$ <font color = "red">Much more difficult to program</font>
<br/><br/> 
${\color{red} \Rightarrow}$ <font color = "black">Several solutions available in software,</font> 
<font color = "red">**however, many not optimal!!**</font>
</div>

# Estimation

## How to solve the integrals

- Two general solutions

<br/>

1. Approximation of the integrand
    + make it look like a normal for which we know the solution
    <br/><br/>
2. Approximation of the integral
    + finite sum over a grid


## Popular available options

- Approximation of the integrand
    + Penalized Quasi Likelihood
    + Laplace approximation
    
<br/>

- Approximation of the integral
    + adaptive Gaussian quadrature
    + Monte Carlo (rejection & importance sampling)

## Which to choose

- Penalized Quasi Likelihood: generally not good

<br/>

- Laplace: needs many repeated measurements per subject
    + it does not work well with binary data and Poisson with low counts

<br/>

- Adaptive Gaussian quadrature: <font color = "magenta">*Gold standard*</font>
    + computationally intensive

<br/>

- Monte Carlo: requires fine tuning
    + no clear winner algorithm
    
# What is available in R


## Does it matter? - 1

- The Toenail dataset `data("toenail", package = "HSAUR2")`
    + mixed effects logistic regression
    + PQL vs Laplace vs adaptive Gaussian quadrature

```{r toenail_analysis, message = FALSE}
pbc2$spiders2 <- as.numeric(pbc2$spiders == "Yes")
fm1 <- geeglm(spiders2 ~ year + drug + age + sex,
              family = binomial(), data = pbc2, id = id, 
              corstr = "independence")

fm2 <- geeglm(spiders2 ~ year + drug + age * sex,
              family = binomial(), data = pbc2, id = id, 
              corstr = "independence")

fm3 <- geeglm(spiders2 ~ year + drug + age * sex,
              family = binomial(), data = pbc2, id = id, 
              corstr = "independence")
```

## Mixed model packages in R - 2

<br/>
<br/>

<div style="float: center; text-align: center; width: 750px; border: 3px solid black">
<br/><br/>
<strong><font size="6" color = "red">Need for adaptive Gaussian quadrature for ${\color{red} > 1}$ random effects</font></strong>
<br/><br/>
</div>

## A new package

<br/>

- **GLMMadaptive** has been written to fill this gap

<br/>

- Principles
    + User-friendly
    + Satisfy the needs of most users
    + Give advanced users the option to extend it
    + Well documented
    
# What GLMMadaptive offers

```r
mixed_model(fixed = y ~ time * group, random = ~ time | id, data = DF,
            family = binomial(), nAGQ = 15)
```

```r
vignette("GLMMadaptive_basics", package = "GLMMadaptive")
```



## Documentation

<br/>

- Up-to-date help files

<br/>

- Dedicated website: [https://drizopoulos.github.io/cvGEE/](https://drizopoulos.github.io/cvGEE/)
    
# What the future holds...

## Future plans

- XXX

<br/>

- XXX

<br/>

- XXX
    
***

<br/> 
<br/> 

<div align = "center">
<font color = "black" size = "6">**Thank you for your attention!**</font>
</div>
<br/>
<div align = "center">
[http://www.drizopoulos.com/](http://www.drizopoulos.com/)
</div>

<br/> 
<br/>
<br/>

<div align = "center">
<font color = "black" size = "5">**These slides are available at:**</font>
</div>
<div align = "center">
<div align = "center">
[https://drizopoulos.github.io/cvGEE_presentations/](https://drizopoulos.github.io/cvGEE_presentations/)
</div>

